{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["\r\n\r\nlet oldArrayProto = Array.prototype;\r\n\r\nexport let newArrayProto = Object.create(oldArrayProto);\r\n\r\nlet methods = [\r\n    'push',\r\n    'pop',\r\n    'shift',\r\n    'unshift',\r\n    'sort',\r\n    'reverse',\r\n    'splice'\r\n]\r\n\r\nmethods.forEach(method => {\r\n    newArrayProto[method] = function(...args) { // 重写了数组的方法\r\n        \r\n        let result = oldArrayProto[method].call(this,...args); // 内部调用了原来的方法\r\n\r\n        // 此外还要对新增的内容进行观测\r\n        let inserted;\r\n        switch(method) {\r\n            case 'push':\r\n            case 'unshift':\r\n                inserted = args;\r\n                break;\r\n            case 'splice':\r\n                inserted = args.slice(2);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        if(inserted) {\r\n            this.__ob__.observeArray(inserted);\r\n        }\r\n        return result;\r\n    }\r\n})","import { newArrayProto } from \"./array\";\r\n\r\nclass Observer{\r\n    constructor(data) {\r\n\r\n        Object.defineProperty(data, '__ob__', {\r\n            value: this,\r\n            enumerable: false    // 属性不可枚举\r\n        })\r\n\r\n        if(Array.isArray(data)) {\r\n            data.__proto__ = newArrayProto;\r\n\r\n            this.observeArray(data);\r\n\r\n        }else{\r\n            this.walk(data);\r\n        }\r\n        \r\n    }\r\n\r\n    walk(data){\r\n        Object.keys(data).forEach(key => defineReactive(data,key,data[key]))\r\n    }\r\n\r\n    observeArray(data) {\r\n        data.forEach(item => observe(item));\r\n    }\r\n}\r\n\r\nfunction defineReactive(data,key,value) {\r\n\r\n    observe(value);  // 递归保证嵌套层级比较深的话  保证里面的属性能有响应式\r\n\r\n    Object.defineProperty(data,key, {\r\n        get(){\r\n            return value;\r\n        },\r\n        set(newValue) {\r\n            if(value == newValue) return;\r\n            value = newValue;\r\n        }\r\n    })\r\n}\r\n\r\nexport function observe(data) {\r\n\r\n    if(typeof data !== 'object' || data == null) { //只劫持对象\r\n        return;\r\n    }\r\n\r\n    if(data.__ob__ instanceof Observer){  // 被劫持了 就不需要再走进去了\r\n        return data.__ob__;\r\n    }\r\n\r\n    return new Observer(data)\r\n\r\n}","import { observe } from \"./observe\";\r\n\r\nexport function initState(vm) {\r\n    const opts = vm.$options;\r\n    if(opts.data) {\r\n        initData(vm);\r\n    }\r\n}\r\n\r\nfunction proxy(vm, target, key) {\r\n   Object.defineProperty(vm, key, {\r\n       get() {\r\n        return vm[target][key]\r\n       },\r\n       set(newValue) {\r\n        vm[target][key] = newValue;\r\n       }\r\n   })\r\n}\r\n\r\nfunction initData(vm) {\r\n    let data = vm.$options.data;\r\n    data = typeof data === 'function' ? data.call(vm) : data;\r\n\r\n    vm._data = data; \r\n\r\n    observe(data);\r\n\r\n    for(let key in data) { // 为了外层取值的方便 所以多加了一层劫持\r\n        proxy(vm,'_data',key)\r\n    }\r\n}","import { initState } from \"./state\";\r\n\r\n\r\nexport function initMixin(Vue) {\r\n    \r\n    Vue.prototype._init = function(options) {\r\n        const vm = this;\r\n        vm.$options = options;\r\n\r\n        initState(vm);\r\n\r\n    }\r\n\r\n}","import {initMixin} from './init'\r\n\r\nfunction Vue(options) {\r\n    this._init(options)\r\n}\r\n\r\ninitMixin(Vue)\r\n\r\n\r\nexport default Vue;"],"names":["oldArrayProto","Array","prototype","newArrayProto","Object","create","methods","forEach","method","args","result","call","inserted","slice","__ob__","observeArray","Observer","data","defineProperty","value","enumerable","isArray","__proto__","walk","keys","key","defineReactive","item","observe","get","set","newValue","initState","vm","opts","$options","initData","proxy","target","_data","initMixin","Vue","_init","options"],"mappings":"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"}